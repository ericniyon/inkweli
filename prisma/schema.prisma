generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String           @id @default(cuid())
  email          String           @unique
  name           String
  passwordHash   String?          @map("password_hash")
  role           UserRole         @default(FREE_USER)
  tier           SubscriptionTier @default(NONE)
  avatar         String?
  bio            String?
  followersCount Int              @default(0) @map("followers_count")
  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")
  articles       Article[]        @relation("Author")
  articleViews   ArticleView[]
  bookmarks      Bookmark[]
  following      Follow[]         @relation("Follower")
  followers      Follow[]         @relation("Following")
  highlights     Highlight[]
  responses      Response[]
  claps          Clap[]
}

model Writer {
  id            String   @id @default(cuid())
  name          String
  role          String?
  bio           String?
  image         String?
  articlesCount Int      @default(0) @map("articles_count")
  twitter       String?
  linkedin      String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
}

model Article {
  id                 String        @id @default(cuid())
  title              String
  slug               String        @unique
  excerpt            String
  content            String
  status             ArticleStatus @default(DRAFT)
  featuredImage      String        @map("featured_image")
  readingTime        Int           @map("reading_time")
  category           String
  claps              Int           @default(0)
  tags               String[]
  publishDate        DateTime      @map("publish_date")
  scheduledPublishAt  DateTime?     @map("scheduled_publish_at")
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")
  authorId           String        @map("author_id")
  author             User          @relation("Author", fields: [authorId], references: [id], onDelete: Cascade)
  views              ArticleView[]
  bookmarks          Bookmark[]
  highlights         Highlight[]
  responses          Response[]
  userClaps         Clap[]
}

model Bookmark {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  articleId String   @map("article_id")
  createdAt DateTime @default(now()) @map("created_at")
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, articleId])
  @@map("bookmarks")
}

model Clap {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  articleId String   @map("article_id")
  createdAt DateTime @default(now()) @map("created_at")
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, articleId])
  @@map("claps")
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String   @map("follower_id")
  followingId String   @map("following_id")
  createdAt   DateTime @default(now()) @map("created_at")
  follower    User     @relation("Follower", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("follows")
}

model Response {
  id        String   @id @default(cuid())
  text      String
  claps     Int      @default(0)
  createdAt DateTime @default(now()) @map("created_at")
  userId    String   @map("user_id")
  articleId String   @map("article_id")
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("responses")
}

model Highlight {
  id        String   @id @default(cuid())
  text      String
  comment   String
  createdAt DateTime @default(now()) @map("created_at")
  userId    String   @map("user_id")
  articleId String   @map("article_id")
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("highlights")
}

model ArticleView {
  id        String   @id @default(cuid())
  userId    String?  @map("user_id")
  articleId String   @map("article_id")
  viewedAt  DateTime @default(now()) @map("viewed_at")
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id])

  @@map("article_views")
}

model SubscriptionPlan {
  id        String   @id
  tier      String
  name      String
  price     Int
  interval  String
  features  String[]
  color     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model SiteLayoutSettings {
  id               String   @id @default("default")
  showLogoInHeader Boolean  @default(true) @map("show_logo_in_header")
  stickyHeader     Boolean  @default(true) @map("sticky_header")
  showHero         Boolean  @default(true) @map("show_hero")
  showTrending     Boolean  @default(true) @map("show_trending")
  showFooter       Boolean  @default(true) @map("show_footer")
  updatedAt        DateTime @updatedAt @map("updated_at")
}

model SiteCategory {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum UserRole {
  ADMIN
  EDITOR
  SUBSCRIBER
  FREE_USER
  USER
}

enum SubscriptionTier {
  UNLIMITED
  TWO_ARTICLES
  ONE_ARTICLE
  NONE
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
}
